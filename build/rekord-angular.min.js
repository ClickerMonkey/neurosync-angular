/* rekord-angular 1.5.7 - A rekord binding to angular - implementing Rekord.rest by Philip Diffenderfer */
!function(e,t){"function"==typeof define&&define.amd?define(["rekord","angular"],function(n,r){return t(e,n,r)}):"object"==typeof module&&module.exports?module.exports=t(global,require("rekord"),require("angular")):e.Rekord=t(e,e.Rekord,e.angular)}(this,function(e,t,n,r){function o(e,n){function o(e){this.database=e}function i(e){return e.api?new o(e):j.call(this,e)}function s(t,n,r){e(t).then(n,r)}function u(e,t){return t?e.api+t.$key():e.api}function c(e,t){return n("date")(e,t)}o.prototype={removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)?e.substring(0,e.length-1):e},buildURL:function(e){return this.removeTrailingSlash(t.Angular.buildURL(this.database,e))},all:function(e,t,n){this.execute("GET",null,r,this.buildURL(),e,t,n,[])},get:function(e,t,n,o){this.execute("GET",e,r,this.buildURL(e),t,n,o)},create:function(e,t,n,r,o){this.execute("POST",e,t,this.buildURL(),n,r,o,{})},update:function(e,t,n,r,o){this.execute("PUT",e,t,this.buildURL(e),n,r,o,{})},remove:function(e,t,n,o){this.execute("DELETE",e,r,this.buildURL(e),t,n,o,{})},query:function(e,t,n,r,o){var i=R(t)?"GET":"POST";this.execute(i,null,t,e,n,r,o)},execute:function(e,n,r,o,i,s,u,c){if(t.debug(t.Debugs.REST,this,e,o,r),t.forceOffline)u(c,0);else{var a=function(e){s(e.data)},l=function(e){u(e.data,e.status)},f=E(t.Angular.vars,E(n,{})),h=E(t.Angular.options,{method:e,data:r,url:o});g(i)&&(E(h,i),g(i.vars)&&E(i.vars,f)),t.Angular.adjustOptions(h,this.database,e,n,r,o,f,s,u),m(h.url)&&(h.url=A(h.url,f)),t.Angular.ajax(h,a,l)}}},t.Rests.Angular=i,t.setRest(i),t.listenToNetworkStatus(),t.formatDate=c,t.Angular={rest:i,options:{},vars:{},adjustOptions:C,ajax:s,buildURL:u,RestClass:o}}function i(e,t,n){return this instanceof i?(this.scope=e,this.target=t,this.callback=n,void this.on()):new i(e,t,n)}function s(e,t,n){this.$onRemove=k(this,this.$handleRemove),this.$onRemoves=k(this,this.$handleRemoves),this.$onCleared=k(this,this.$handleCleared),this.$onReset=k(this,this.$handleReset),this.$reset(e),this.$select(t,n)}function u(e){if(e in u.tested)return u.tested[e];try{n.module(e),u.tested[e]=!0}catch(t){u.tested[e]=!1}return u.tested[e]}function c(){return c.cached?c.cached:c.cached=u("ui.router")?"$stateParams":!!u("ngRoute")&&"$route"}function a(){return u("ui.router")?function(e){return e}:u("ngRoute")?function(e){return e.current}:function(){return!1}}function l(e){return function(t){return $(t)&&e?A(t,e):t}}function f(e,t){if(g(e)){var n={};for(var r in e)n[r]=t(e[r]);return n}return t(e)}function h(){return function(e){if(!e||!e.toArray)return e;for(var t=e.toArray(),n={},r=0;r<t.length;r++){var o=t[r];!o.$key||o.$key()in n?t.splice(r--,1):n[o.$key()]=o}return t}}var d=n.module("rekord",[]),v=t.isFunction,$=t.isString,p=t.isArray,g=t.isObject,y=t.isBoolean,b=t.isRekord,R=t.isEmpty,m=t.isFormatInput,A=t.format,k=t.bind,C=t.noop,E=t.transfer,j=t.rest,D={},S={};return n.isArray=function(e){return e instanceof Array},i.prototype={on:function(){var e=this.target;b(e)&&(e=this.target=e.Database);var t=e.$change?"$change":"change";e[t]&&(this.off=e[t](this.notify,this),this.scope.$on("$destroy",this.off))},notify:function(){this.scope.$evalAsync(),v(this.callback)&&this.callback.apply(this.target),t.debug(t.Debugs.ScopeDigest,this,this.scope)}},s.prototype={$reset:function(e){this.$source!==e&&(this.$source&&this.$disconnect(),this.$source=e,this.$connect())},$connect:function(){this.$source.on(t.Collection.Events.Remove,this.$onRemove),this.$source.on(t.Collection.Events.Removes,this.$onRemoves),this.$source.on(t.Collection.Events.Cleared,this.$onCleared),this.$source.on(t.Collection.Events.Reset,this.$onReset)},$disconnect:function(){this.$source.off(t.Collection.Events.Remove,this.$onRemove),this.$source.off(t.Collection.Events.Removes,this.$onRemoves),this.$source.off(t.Collection.Events.Cleared,this.$onCleared),this.$source.off(t.Collection.Events.Reset,this.$onReset)},$select:function(e,t){if(p(e)){var n=this.$source.database,r={};for(var o in this)y(this[o])&&(r[o]=this[o]);for(var i=0;i<e.length;i++){var o=n.keyHandler.buildKeyFromInput(e[i]);this[o]=!0,delete r[o]}for(var o in r)delete this[o];if(t)for(var s=this.$source.keys(),i=0;i<s.length;i++){var o=s[i];this[o]||(this[o]=!1)}}},$selection:function(e){var t=this.$source,n=e||[];for(var r in this)if(this[r]===!0){var o=t.get(r);o&&n.push(o)}return n},$handleRemove:function(e){var t=this.$source.database,n=t.keyHandler.buildKeyFromInput(e);delete this[n]},$handleRemoves:function(e){for(var t=0;t<e.length;t++)this.$handleRemove(e[t])},$handleCleared:function(){for(var e in this)y(this[e])&&delete this[e]},$handleReset:function(){var e=this.$source;for(var t in this)y(this[t])&&(e.has(t)||delete this[t])}},t.ModelCollection.prototype.selectable=function(e,t){return new s(this,e,t)},u.tested={},c.cached=null,D.factory=function(e,n){function r(r,o){var c=r.defer();if(void 0!==u)c.resolve(u);else{var a=i(o),f=l(a);s&&c.promise.then(function(e){u=e}),t.get(e).success(function(e){n(e,c,f)})}return c.promise}var o=c(),i=a(),s=!1,u=void 0;return r.$inject=["$q"],o&&r.$inject.push(o),r.cache=function(){return s=!0,r},r.inject=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];p(t)?r.$inject.push.apply(r.$inject,t):r.$inject.push(t)}return r},r},D.model=function(e,t){return D.factory(e,function(e,n,r){var o=f(t,r);e.Database.grabModel(o,function(e){e?n.resolve(e):n.reject()})})},D.fetch=function(e,t,n){return D.factory(e,function(e,r,o){var i=f(t,o);e.fetch(i,n,function(e){r.resolve(e)})})},D.fetchAll=function(e){return D.factory(e,function(e,t,n){e.fetchAll(function(e){t.resolve(e)})})},D.grab=function(e,t,n){return D.factory(e,function(e,r,o){var i=f(t,o);e.grab(i,n,function(e){r.resolve(e)})})},D.grabAll=function(e){return D.factory(e,function(e,t,n){e.grabAll(function(e){t.resolve(e)})})},D.create=function(e,n,r,o,i){return D.factory(e,function(e,s,u){var c=f(n,u);if(r)s.resolve(new e(c));else{var a=e.create(c,o,i);a.$isSaved()?s.resolve(a):a.$once(t.Model.Events.RemoteSaves,function(){s.resolve(a)})}})},D.search=function(e,t,n,r){return D.factory(e,function(e,o,i){var s=f(t,i),u=e.search(s,n,r,!0);u.$promise.success(function(){o.resolve(u)}),u.$promise.failure(function(){o.reject()})})},D.searchAt=function(e,t,n,r,o,i){return D.factory(e,function(e,s,u){var c=f(t,u),a=f(n,u),l=e.searchAt(c,a,r,o,i);l.complete(function(e){s.resolve(e)})})},D.all=function(e){return D.factory(e,function(e,t,n){e.Database.ready(function(){t.resolve(e.all())})})},D.where=function(e,t,n,r){return D.factory(e,function(e,o,i){var s=f(t,i),u=f(n,i);e.Database.ready(function(){o.resolve(e.all().filtered(s,u,r))})})},D.ready=function(e){return D.factory(e,function(e,t,n){e.Database.ready(function(){t.resolve(e)})})},S.helper=function(e,n){var r=null;return t.get(e).success(function(e){r=e}),function(){if(!r)throw e+" Rekord failed to load or does not exist.";return n(r)}},S.search=function(e,t,n,r,o,i){return S.helper(e,function(e){return i?e.searchPaged(t,n,r,o):e.search(t,n,r,o)})},S.ref=function(e,t,n){return S.helper(e,function(e){return e})},S.lazyLoad=function(e,t,n){var r={};return S.helper(e,function(o){return o.Database.remoteLoaded||e in r||(r[e]=!0,o.Database.refresh(t,n)),o})},S.filtered=function(e,t,n,r){return S.helper(e,function(e){return e.filtered(t,n,r)})},S.all=function(e){return S.helper(e,function(e){return e.all()})},S.fetchAll=function(e,t,n){return S.helper(e,function(e){return e.fetchAll(t,n)})},S.grabAll=function(e,t,n){return S.helper(e,function(e){return e.grabAll(t,n)})},d.run(["$http","$filter",o]).filter("models",h),t.Bind=i,t.Sync=i,t.Resolve=D,t.Select=s,t.Factory=S,t.Debugs.ScopeDigest=1e5,t});
//# sourceMappingURL=rekord-angular.min.js.map
