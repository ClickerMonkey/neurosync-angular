!function(e,t,n){function o(e){var t=Rekord.debug;Rekord.restSet||(Rekord.rest=function(t){function o(e){return"/"===e.charAt(e.length-1)?e.substring(0,e.length-1):e}function r(t,n,o,r,i,s){function u(e){r(e.data)}function a(e){i(e.data,e.status)}if(Rekord.debug(Rekord.Debugs.REST,this,t,o,n),Rekord.forceOffline)i(s,0);else{var c={method:t,data:n,url:o};e(c).then(u,a)}}return{all:function(e,o){r("GET",n,t.api,e,o,[])},get:function(e,i,s){r("GET",n,o(t.api+e.$key()),i,s)},create:function(e,n,i,s){r("POST",n,o(t.api),i,s,{})},update:function(e,n,i,s){r("PUT",n,o(t.api+e.$key()),i,s,{})},remove:function(e,i,s){r("DELETE",n,o(t.api+e.$key()),i,s,{})},query:function(e,t,o){var i=e.method||"GET",s=e.data||n,u=e.url||e;r(i,s,u,t,o)}}},Rekord.restSet=!0),Rekord.debug=function(){h.debug&&t.apply(this,arguments)},Rekord.Debugs.ScopeEval=1e5,Rekord.listenToNetworkStatus()}function r(e,t,n){return this instanceof r?(this.scope=e,this.target=t,this.callback=n,this.notify=this.newNotification(),this.release=this.newRelease(),void this.on()):new r(e,t,n)}function i(e,t,n){this.$onRemove=Rekord.bind(this,this.$handleRemove),this.$onRemoves=Rekord.bind(this,this.$handleRemoves),this.$onCleared=Rekord.bind(this,this.$handleCleared),this.$onReset=Rekord.bind(this,this.$handleReset),this.$reset(e),this.$select(t,n)}function s(e){if(e in s.tested)return s.tested[e];try{return angular.module(e),s.tested[e]=!0}catch(t){return s.tested[e]=!1}}function u(){return u.cached?u.cached:u.cached=s("ui.router")?"$stateParams":s("ngRoute")?"$route":!1}function a(){return s("ui.router")?function(e){return e}:s("ngRoute")?function(e){return e.current}:function(){return!1}}function c(e){return function(t){return Rekord.isString(t)&&e?Rekord.format(t,e):t}}function f(e,t){if(Rekord.isObject(e)){var n={};for(var o in e)n[o]=t(e[o]);return n}return t(e)}var h={debug:!1},l={};e.constant("RekordSettings",h).constant("Rekord",Rekord).constant("RekordBind",r).constant("RekordResolve",l).constant("RekordSelect",i).run(["$http",o]),t.RekordBind=r,t.RekordResolve=l,t.RekordSelect=i,r.Events={Database:"updated",Model:"saved removed remote-update relation-update",Collection:"add adds sort remove reset",Page:"change",Scope:"$destroy"},r.prototype={on:function(){Rekord.isRekord(this.target)&&(this.target=this.target.Database),this.target instanceof Rekord.Database?this.target.on(r.Events.Database,this.notify):this.target instanceof Rekord.Model?this.target.$on(r.Events.Model,this.notify):this.target instanceof Rekord.Collection?this.target.on(r.Events.Collection,this.notify):this.target instanceof Rekord.Page&&this.target.on(r.Events.Page,this.notify),this.scope.$on(r.Events.Scope,this.release)},off:function(){this.target instanceof Rekord.Database?this.target.off(r.Events.Database,this.notify):this.target instanceof Rekord.Model?this.target.$off(r.Events.Model,this.notify):this.target instanceof Rekord.Collection?this.target.off(r.Events.Collection,this.notify):this.target instanceof Rekord.Page&&this.target.off(r.Events.Page,this.notify)},newRelease:function(){var e=this;return function(){e.off()}},newNotification:function(){var e=this;return function(){e.scope.$evalAsync(function(){e.callback&&e.callback.apply(e.target),h.debug&&Rekord.debug("[Scope:$evalAsync]",e.scope)})}}},i.prototype={$reset:function(e){this.$source!==e&&(this.$source&&this.$disconnect(),this.$source=e,this.$connect())},$connect:function(){this.$source.on(Rekord.Collection.Events.Remove,this.$onRemove),this.$source.on(Rekord.Collection.Events.Removes,this.$onRemoves),this.$source.on(Rekord.Collection.Events.Cleared,this.$onCleared),this.$source.on(Rekord.Collection.Events.Reset,this.$onReset)},$disconnect:function(){this.$source.off(Rekord.Collection.Events.Remove,this.$onRemove),this.$source.off(Rekord.Collection.Events.Removes,this.$onRemoves),this.$source.off(Rekord.Collection.Events.Cleared,this.$onCleared),this.$source.off(Rekord.Collection.Events.Reset,this.$onReset)},$select:function(e,t){if(Rekord.isArray(e)){var n=this.$source.database,o={};for(var r in this)Rekord.isBoolean(this[r])&&(o[r]=this[r]);for(var i=0;i<e.length;i++){var r=n.buildKeyFromInput(e[i]);this[r]=!0,delete o[r]}for(var r in o)delete this[r];if(t)for(var s=this.$source.keys(),i=0;i<s.length;i++){var r=s[i];this[r]||(this[r]=!1)}}},$selection:function(e){var t=this.$source,n=e||[];for(var o in this)if(this[o]===!0){var r=t.get(o);r&&n.push(r)}return n},$handleRemove:function(e){var t=this.$source.database,n=t.buildKeyFromInput(e);delete this[n]},$handleRemoves:function(e){for(var t=0;t<e.length;t++)this.$handleRemove(e[t])},$handleCleared:function(){for(var e in this)Rekord.isBoolean(this[e])&&delete this[e]},$handleReset:function(){var e=this.$source;for(var t in this)Rekord.isBoolean(this[t])&&(e.has(t)||delete this[t])}},Rekord.ModelCollection.prototype.selectable=function(e,t){return new i(this,e,t)},s.tested={},u.cached=null,l.factory=function(e,t){function n(n,o){var u=n.defer();if(void 0!==s)u.resolve(s);else{var a=r(o),f=c(a);i&&u.promise.then(function(e){s=e}),Rekord.get(e,function(e){t(e,u,f)})}return u.promise}var o=u(),r=a(),i=!1,s=void 0;return n.$inject=["$q"],o&&n.$inject.push(o),n.cache=function(){return i=!0,n},n.inject=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];Rekord.isArray(t)?n.$inject.push.apply(n.$inject,t):n.$inject.push(t)}return n},n},l.model=function(e,t){return l.factory(e,function(e,n,o){var r=f(t,o);e.Database.grabModel(r,function(e){e?n.resolve(e):n.reject()})})},l.fetch=function(e,t){return l.factory(e,function(e,n,o){var r=f(t,o);e.fetch(r,function(e){n.resolve(e)})})},l.fetchAll=function(e){return l.factory(e,function(e,t,n){e.fetchAll(function(e){t.resolve(e)})})},l.grab=function(e,t){return l.factory(e,function(e,n,o){var r=f(t,o);e.grab(r,function(e){n.resolve(e)})})},l.grabAll=function(e){return l.factory(e,function(e,t,n){e.grabAll(function(e){t.resolve(e)})})},l.create=function(e,t,n){return l.factory(e,function(e,o,r){var i=f(t,r);if(n)o.resolve(new e(i));else{var s=e.create(i);s.$isSaved()?o.resolve(s):s.$once(Rekord.Model.Events.RemoteSaves,function(){o.resolve(s)})}})},l.query=function(e,t){return l.factory(e,function(e,n,o){var r=f(t,o),i=e.query(r);i.success(function(){n.resolve(i)}),i.failure(function(){n.reject()})})},l.all=function(e){return l.factory(e,function(e,t,n){e.Database.ready(function(){t.resolve(e.all())})})},l.where=function(e,t,n,o){return l.factory(e,function(e,r,i){var s=f(t,i),u=f(n,i);e.Database.ready(function(){r.resolve(e.all().filtered(s,u,o))})})}}(angular.module("rekord",[]),this);
//# sourceMappingURL=rekord-angular.min.js.map
