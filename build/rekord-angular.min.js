/* rekord-angular 1.4.3 - A rekord binding to angular - implementing Rekord.rest by Philip Diffenderfer */
!function(e,t){"function"==typeof define&&define.amd?define(["Rekord","angular"],function(n,r){return t(e,n,r)}):"object"==typeof module&&module.exports?module.exports=t(global,require("Rekord"),require("angular")):e.Rekord=t(e,e.Rekord,e.angular)}(this,function(e,t,n,r){function o(e,n){function o(e){this.database=e}function i(e){return e.api?new o(e):E.call(this,e)}function s(t,n,r){e(t).then(n,r)}function a(e,t){return n("date")(e,t)}o.prototype={removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)?e.substring(0,e.length-1):e},all:function(e,t){this.execute("GET",null,r,this.database.api,e,t,[])},get:function(e,t,n){this.execute("GET",e,r,this.removeTrailingSlash(this.database.api+e.$key()),t,n)},create:function(e,t,n,r){this.execute("POST",e,t,this.removeTrailingSlash(this.database.api),n,r,{})},update:function(e,t,n,r){this.execute("PUT",e,t,this.removeTrailingSlash(this.database.api+e.$key()),n,r,{})},remove:function(e,t,n){this.execute("DELETE",e,r,this.removeTrailingSlash(this.database.api+e.$key()),t,n,{})},query:function(e,t,n,r){var o=b(t)?"GET":"POST";this.execute(o,null,t,e,n,r)},execute:function(e,n,r,o,i,s,a){if(t.debug(t.Debugs.REST,this,e,o,r),t.forceOffline)s(a,0);else{var u=function(e){i(e.data)},c=function(e){s(e.data,e.status)},l=C(t.Angular.options,{method:e,data:r,url:o});t.Angular.adjustOptions(l,this.database,e,n,r,o,i,s),t.Angular.ajax(l,u,c)}}},t.setRest(i),t.listenToNetworkStatus(),t.formatDate=a,t.Angular={rest:i,options:{},adjustOptions:A,ajax:s,RestClass:o}}function i(e,t,n){return this instanceof i?(this.scope=e,this.target=t,this.callback=n,void this.on()):new i(e,t,n)}function s(e,t,n){this.$onRemove=k(this,this.$handleRemove),this.$onRemoves=k(this,this.$handleRemoves),this.$onCleared=k(this,this.$handleCleared),this.$onReset=k(this,this.$handleReset),this.$reset(e),this.$select(t,n)}function a(e){if(e in a.tested)return a.tested[e];try{n.module(e),a.tested[e]=!0}catch(t){a.tested[e]=!1}return a.tested[e]}function u(){return u.cached?u.cached:u.cached=a("ui.router")?"$stateParams":a("ngRoute")?"$route":!1}function c(){return a("ui.router")?function(e){return e}:a("ngRoute")?function(e){return e.current}:function(){return!1}}function l(e){return function(t){return $(t)&&e?R(t,e):t}}function f(e,t){if(g(e)){var n={};for(var r in e)n[r]=t(e[r]);return n}return t(e)}function h(){return function(e){if(!e||!e.toArray)return e;for(var t=e.toArray(),n={},r=0;r<t.length;r++){var o=t[r];!o.$key||o.$key()in n?t.splice(r--,1):n[o.$key()]=o}return t}}var d=n.module("rekord",[]),v=t.isFunction,$=t.isString,p=t.isArray,g=t.isObject,y=t.isBoolean,m=t.isRekord,b=t.isEmpty,R=t.format,k=t.bind,A=t.noop,C=t.transfer,E=t.rest,S={},j={};return n.isArray=function(e){return e instanceof Array},i.prototype={on:function(){var e=this.target;m(e)&&(e=this.target=e.Database);var t=e.$change?"$change":"change";e[t]&&(this.off=e[t](this.notify,this),this.scope.$on("$destroy",this.off))},notify:function(){this.scope.$evalAsync(),v(this.callback)&&this.callback.apply(this.target),t.debug(t.Debugs.ScopeDigest,this,this.scope)}},s.prototype={$reset:function(e){this.$source!==e&&(this.$source&&this.$disconnect(),this.$source=e,this.$connect())},$connect:function(){this.$source.on(t.Collection.Events.Remove,this.$onRemove),this.$source.on(t.Collection.Events.Removes,this.$onRemoves),this.$source.on(t.Collection.Events.Cleared,this.$onCleared),this.$source.on(t.Collection.Events.Reset,this.$onReset)},$disconnect:function(){this.$source.off(t.Collection.Events.Remove,this.$onRemove),this.$source.off(t.Collection.Events.Removes,this.$onRemoves),this.$source.off(t.Collection.Events.Cleared,this.$onCleared),this.$source.off(t.Collection.Events.Reset,this.$onReset)},$select:function(e,t){if(p(e)){var n=this.$source.database,r={};for(var o in this)y(this[o])&&(r[o]=this[o]);for(var i=0;i<e.length;i++){var o=n.keyHandler.buildKeyFromInput(e[i]);this[o]=!0,delete r[o]}for(var o in r)delete this[o];if(t)for(var s=this.$source.keys(),i=0;i<s.length;i++){var o=s[i];this[o]||(this[o]=!1)}}},$selection:function(e){var t=this.$source,n=e||[];for(var r in this)if(this[r]===!0){var o=t.get(r);o&&n.push(o)}return n},$handleRemove:function(e){var t=this.$source.database,n=t.keyHandler.buildKeyFromInput(e);delete this[n]},$handleRemoves:function(e){for(var t=0;t<e.length;t++)this.$handleRemove(e[t])},$handleCleared:function(){for(var e in this)y(this[e])&&delete this[e]},$handleReset:function(){var e=this.$source;for(var t in this)y(this[t])&&(e.has(t)||delete this[t])}},t.ModelCollection.prototype.selectable=function(e,t){return new s(this,e,t)},a.tested={},u.cached=null,S.factory=function(e,n){function r(r,o){var u=r.defer();if(void 0!==a)u.resolve(a);else{var c=i(o),f=l(c);s&&u.promise.then(function(e){a=e}),t.get(e).success(function(e){n(e,u,f)})}return u.promise}var o=u(),i=c(),s=!1,a=void 0;return r.$inject=["$q"],o&&r.$inject.push(o),r.cache=function(){return s=!0,r},r.inject=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];p(t)?r.$inject.push.apply(r.$inject,t):r.$inject.push(t)}return r},r},S.model=function(e,t){return S.factory(e,function(e,n,r){var o=f(t,r);e.Database.grabModel(o,function(e){e?n.resolve(e):n.reject()})})},S.fetch=function(e,t){return S.factory(e,function(e,n,r){var o=f(t,r);e.fetch(o,function(e){n.resolve(e)})})},S.fetchAll=function(e){return S.factory(e,function(e,t,n){e.fetchAll(function(e){t.resolve(e)})})},S.grab=function(e,t){return S.factory(e,function(e,n,r){var o=f(t,r);e.grab(o,function(e){n.resolve(e)})})},S.grabAll=function(e){return S.factory(e,function(e,t,n){e.grabAll(function(e){t.resolve(e)})})},S.create=function(e,n,r){return S.factory(e,function(e,o,i){var s=f(n,i);if(r)o.resolve(new e(s));else{var a=e.create(s);a.$isSaved()?o.resolve(a):a.$once(t.Model.Events.RemoteSaves,function(){o.resolve(a)})}})},S.search=function(e,t,n,r){return S.factory(e,function(e,o,i){var s=f(t,i),a=e.search(s,n,r,!0);a.$promise.success(function(){o.resolve(a)}),a.$promise.failure(function(){o.reject()})})},S.all=function(e){return S.factory(e,function(e,t,n){e.Database.ready(function(){t.resolve(e.all())})})},S.where=function(e,t,n,r){return S.factory(e,function(e,o,i){var s=f(t,i),a=f(n,i);e.Database.ready(function(){o.resolve(e.all().filtered(s,a,r))})})},j.helper=function(e,n){var r=null;return t.get(e).success(function(e){r=e}),function(){if(!r)throw e+" Rekord failed to load or does not exist.";return n(r)}},j.search=function(e,t,n,r,o,i){return j.helper(e,function(e){return i?e.searchPaged(t,n,r,o):e.search(t,n,r,o)})},j.ref=function(e,t,n){return j.helper(e,function(e){return e})},j.lazyLoad=function(e,t,n){var r={};return j.helper(e,function(o){return o.Database.remoteLoaded||e in r||(r[e]=!0,o.Database.refresh(t,n)),o})},j.filtered=function(e,t,n,r){return j.helper(e,function(e){return e.filtered(t,n,r)})},j.all=function(e){return j.helper(e,function(e){return e.all()})},j.fetchAll=function(e,t,n){return j.helper(e,function(e){return e.fetchAll(t,n)})},j.grabAll=function(e,t,n){return j.helper(e,function(e){return e.grabAll(t,n)})},d.run(["$http","$filter",o]).filter("models",h),t.Bind=i,t.Sync=i,t.Resolve=S,t.Select=s,t.Factory=j,t.Debugs.ScopeDigest=1e5,t});
//# sourceMappingURL=rekord-angular.min.js.map
