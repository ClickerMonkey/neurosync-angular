!function(e,t,n){function o(e){Neuro.rest=function(t){function o(e){return"/"===e.charAt(e.length-1)?e.substring(0,e.length-1):e}function r(t,n,o,r,i,s){function u(e){r(e.data)}function a(e){i(e.data,e.status)}if(Neuro.debug(Neuro.Debugs.REST,this,t,o,n),Neuro.forceOffline)i(s,0);else{var c={method:t,data:n,url:o};e(c).then(u,a)}}return{all:function(e,o){r("GET",n,t.api,e,o,[])},get:function(e,i,s){r("GET",n,o(t.api+e.$key()),i,s)},create:function(e,n,i,s){r("POST",n,o(t.api),i,s,{})},update:function(e,n,i,s){r("PUT",n,o(t.api+e.$key()),i,s,{})},remove:function(e,i,s){r("DELETE",n,o(t.api+e.$key()),i,s,{})},query:function(e,t,o){var i=e.method||"GET",s=e.data||n,u=e.url||e;r(i,s,u,t,o)}}};var t=Neuro.debug;return Neuro.debug=function(){d.debug&&t.apply(this,arguments)},Neuro.Debugs.ScopeEval=1e5,Neuro.listenToNetworkStatus(),Neuro}function r(){return s}function i(){return u}function s(e,t,n){return this instanceof s?(this.scope=e,this.target=t,this.callback=n,this.notify=this.newNotification(),this.release=this.newRelease(),void this.on()):new s(e,t,n)}function u(e,t,n){this.$onRemove=Neuro.copyFunction(this.$handleRemove),this.$onRemoves=Neuro.copyFunction(this.$handleRemoves),this.$onCleared=Neuro.copyFunction(this.$handleCleared),this.$onReset=Neuro.copyFunction(this.$handleReset),this.$reset(e),this.$select(t,n)}function a(e,t){return e.replace($,function(e,n){return n in t?t[n]:""})}function c(e){if(e in c.tested)return c.tested[e];try{return angular.module(e),c.tested[e]=!0}catch(t){return c.tested[e]=!1}}function f(){return f.cached?f.cached:f.cached=c("ui.router")?"$stateParams":c("ngRoute")?"$route":!1}function h(){return c("ui.router")?function(e){return e}:c("ngRoute")?function(e){return e.current}:function(){return!1}}function l(e){return function(t){return Neuro.isString(t)&&e?a(t,e):t}}var d={debug:!1},v={};e.constant("NeuroResolve",v).constant("NeuroSettings",d).factory("Neuro",["$http",o]).factory("NeuroBind",r).factory("NeuroSelect",i),t.NeuroBind=s,t.NeuroResolve=v,t.NeuroSelect=u,s.Events={Database:"updated",Model:"saved removed remote-update relation-update",Collection:"add adds sort remove reset",Page:"change",Scope:"$destroy"},s.prototype={on:function(){Neuro.isNeuro(this.target)&&(this.target=this.target.Database),this.target instanceof Neuro.Database?this.target.on(s.Events.Database,this.notify):this.target instanceof Neuro.Model?this.target.$on(s.Events.Model,this.notify):this.target instanceof Neuro.Collection?this.target.on(s.Events.Collection,this.notify):this.target instanceof Neuro.Page&&this.target.on(s.Events.Page,this.notify),this.scope.$on(s.Events.Scope,this.release)},off:function(){this.target instanceof Neuro.Database?this.target.off(s.Events.Database,this.notify):this.target instanceof Neuro.Model?this.target.$off(s.Events.Model,this.notify):this.target instanceof Neuro.Collection?this.target.off(s.Events.Collection,this.notify):this.target instanceof Neuro.Page&&this.target.off(s.Events.Page,this.notify)},newRelease:function(){var e=this;return function(){e.off()}},newNotification:function(){var e=this;return function(){e.scope.$evalAsync(function(){e.callback&&e.callback.apply(e.target),d.debug&&Neuro.debug("[Scope:$evalAsync]",e.scope)})}}},u.prototype={$reset:function(e){this.$source!==e&&(this.$source&&this.$disconnect(),this.$source=e,this.$connect())},$connect:function(){this.$source.on(Neuro.Collection.Events.Remove,this.$onRemove,this),this.$source.on(Neuro.Collection.Events.Removes,this.$onRemoves,this),this.$source.on(Neuro.Collection.Events.Cleared,this.$onCleared,this),this.$source.on(Neuro.Collection.Events.Reset,this.$onReset,this)},$disconnect:function(){this.$source.off(Neuro.Collection.Events.Remove,this.$onRemove),this.$source.off(Neuro.Collection.Events.Removes,this.$onRemoves),this.$source.off(Neuro.Collection.Events.Cleared,this.$onCleared),this.$source.off(Neuro.Collection.Events.Reset,this.$onReset)},$select:function(e,t){if(Neuro.isArray(e)){var n=this.$source.database,o={};for(var r in this)"boolean"==typeof this[r]&&(o[r]=this[r]);for(var i=0;i<e.length;i++){var r=n.buildKeyFromInput(e[i]);this[r]=!0,delete o[r]}for(var r in o)delete this[r];if(t)for(var s=this.$source.keys(),i=0;i<s.length;i++){var r=s[i];this[r]||(this[r]=!1)}}},$selection:function(e){var t=this.$source,n=e||[];for(var o in this)if(this[o]===!0){var r=t.get(o);r&&n.push(r)}return n},$handleRemove:function(e){var t=this.$source.database,n=t.buildKeyFromInput(e);delete this[n]},$handleRemoves:function(e){for(var t=0;t<e.length;t++)this.$handleRemove(e[t])},$handleCleared:function(){for(var e in this)"boolean"==typeof this[e]&&delete this[e]},$handleReset:function(){var e=this.$source;for(var t in this)"boolean"==typeof this[t]&&(e.has(t)||delete this[t])}},Neuro.ModelCollection.prototype.selectable=function(e,t){return new u(this,e,t)};var $=/\{([^\}]+)\}/;c.tested={},f.cached=null,v.factory=function(e,t){var n=f(),o=h(),r=!1,i=void 0,s=["$q",function(n,s){var u=n.defer();if(void 0!==i)u.resolve(i);else{var a=o(s),c=l(a);r&&u.promise.then(function(e){i=e}),Neuro.get(e,function(e){t(e,u,c)})}return u.promise}];return n&&s.splice(1,0,n),s.cache=function(){return r=!0,s},s},v.model=function(e,t){return v.factory(e,function(e,n,o){e.Database.grabModel(o(t),function(e){e?n.resolve(e):n.reject()})})},v.fetch=function(e,t){return v.factory(e,function(e,n,o){n.resolve(e.fetch(o(t)))})},v.fetchAll=function(e){return v.factory(e,function(e,t,n){e.fetchAll(function(e){t.resolve(e)})})},v.create=function(e,t,n){return v.factory(e,function(e,o,r){n?o.resolve(new e(t)):o.resolve(e.create(t))})},v.query=function(e,t){return v.factory(e,function(e,n,o){var r=e.query(o(t));r.success(function(){n.resolve(r)}),r.failure(function(){n.reject()})})},v.all=function(e){return v.factory(e,function(e,t,n){e.Database.ready(function(){t.resolve(e.all())})})},v.where=function(e,t,n,o){return v.factory(e,function(e,r,i){if(Neuro.isObject(t))for(var s in t)t[s]=i(t[s]);Neuro.isString(n)&&(n=i(n)),e.Database.ready(function(){r.resolve(e.all().filtered(t,n,o))})})}}(angular.module("neurosync",[]),window);
//# sourceMappingURL=neurosync-angular.min.js.map
